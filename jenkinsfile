pipeline{
    agent any
    stages ('Artifactory configuration') {
        stage ('clone') {
            steps {
                git branch: 'main', url: 'https://github.com/virtualram-rgb/spring-petclinic.git'
            }
            steps {
                rtServer (
                    id: "JFROG_ID",
                    url: "https://vmdevops.jfrog.io/",
                    credentialsId: "JFROG_CRED_ID"
                )    
                rtMavenDeployer (
                    id: "MAVEN_DEPLOYER",
                    serverId: "JFROG_ID",
                    releaseRepo: "virtualram-lib-release-local",
                    snapshotRepo: "virtualram-lib-snapshot-local"
                )
            }
        }
        stage('Exec Maven') {
            steps {
                rtMavenRun (
                    tool: "mvn_set", // Tool name from Jenkins configuration
                    pom: 'pom.xml',
                    goals: 'clean install',
                    deployerId: "MAVEN_DEPLOYER"
                )
            }
        }    
        stage('Publish build info') {
            steps {
                rtPublishBuildInfo (
                serverId: "JFROG_ID"
                )
            }
        }
    }
}


